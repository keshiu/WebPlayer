"use strict";var main=function(){var n,e,t,o,a,i,r,c,u={},d=null,l=512,f=120,s=function(n,e){var t=document.createElement("canvas");return t.width=n,t.height=e,t},m=function(){u=this.files,i=u[0]},g=function(n,e){var t=new FileReader;t.onload=function(){var n=t.result,o=new jDataView(t.result);"TAG"==o.getString(3,o.byteLength-128)?(c=o.getString(30,o.tell()),r=o.getString(30,o.tell())):(c="Unknown",r="Unknown"),$("header .name_and_author").empty();var a=$("<p>").text(r+" - "+c);$("header .name_and_author").append(a),e(n)},t.onerror=function(e){e.target.error.code==e.target.error.NOT_READABLE_ERR&&alert("Failed to read file: "+n.name)},t.readAsArrayBuffer(n)},h=function(){function n(){e=requestAnimationFrame(n),a.getByteTimeDomainData(c),d.fillStyle="rgb(255, 255, 255)",d.fillRect(0,0,t,i),d.lineWidth=2,d.strokeStyle="rgb(47, 79, 79)",d.beginPath();for(var u=1*t/r,l=0,f=0;r>f;f++){var s=c[f]/128,m=s*i/2;0===f?d.moveTo(l,m):d.lineTo(l,m),l+=u}d.lineTo(o.width,o.height/2),d.stroke()}var e,t=o.width,i=o.height,r=a.frequencyBinCount,c=new Uint8Array(r);a.fftSize=2048,d.clearRect(0,0,t,i),n()},p=function(o){n.decodeAudioData(o,function(o){e=o,t=n.createBufferSource(),a=n.createAnalyser(),t.buffer=e,t.loop=!1,t.connect(a),a.connect(n.destination),h(),w()},function(n){console.log("Error decoding file "+n)})},w=function(){t.start(0)},v=function(){t.stop(0)};window.addEventListener("load",function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,n=new AudioContext,o=s(l,f),$("#visualField").append(o),d=o.getContext("2d")}catch(e){alert("Opps.. Your browser do not support audio API")}},!1);var y=document.getElementById("download");y.addEventListener("change",m,!1),$("#play").click(function(){g(i,p)}),$("#stop").click(function(){v()})};$(document).ready(main);
