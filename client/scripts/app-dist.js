"use strict";var main=function(){var e,n,t,o,r,a,i,c,u,f=!0,d=!1,l=null,g=512,y=120,s="normal",p=[60,170,310,600,1e3,3e3,6e3,12e3,14e3,16e3],m=[{frequency:60,gain:-2},{frequency:170,gain:4},{frequency:310,gain:-7},{frequency:600,gain:8},{frequency:1e3,gain:5},{frequency:3e3,gain:0},{frequency:6e3,gain:-3},{frequency:12e3,gain:-3},{frequency:14e3,gain:-2},{frequency:16e3,gain:-2}],v=[{frequency:60,gain:7},{frequency:170,gain:5},{frequency:310,gain:-5},{frequency:600,gain:-8},{frequency:1e3,gain:-4},{frequency:3e3,gain:4},{frequency:6e3,gain:9},{frequency:12e3,gain:11},{frequency:14e3,gain:11},{frequency:16e3,gain:11}],q=[{frequency:60,gain:5},{frequency:170,gain:1},{frequency:310,gain:0},{frequency:600,gain:-2},{frequency:1e3,gain:0},{frequency:3e3,gain:4},{frequency:6e3,gain:7},{frequency:12e3,gain:9},{frequency:14e3,gain:11},{frequency:16e3,gain:12}],h=[{frequency:60,gain:0},{frequency:170,gain:0},{frequency:310,gain:0},{frequency:600,gain:0},{frequency:1e3,gain:0},{frequency:3e3,gain:0},{frequency:6e3,gain:-7},{frequency:12e3,gain:-7},{frequency:14e3,gain:-7},{frequency:16e3,gain:-9}],w=function(e,n){var t=document.createElement("canvas");return t.width=e,t.height=n,t},A=function(e){f=!0,a=e[0];var n=$("<p>").text(a.name);$("main .drop_zone").empty(),$("main .drop_zone").append(n),s="normal",document.getElementById("normal").click()},E=function(){var e=this.files;A(e)},k=function(e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer.files;A(n)},S=function(n){var t=e.createBiquadFilter();return t.type="peaking",t.frequency.value=n,t.Q.value=1,t.gain.value=0,t},_=function(){var e;return e=p.map(S),e.reduce(function(e,n){return e.connect(n),n}),e},T=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},C=function(e,n,t){var o=new FileReader;o.onload=function(){var n=o.result,r=new jDataView(o.result);"TAG"===r.getString(3,r.byteLength-128)?(u=r.getString(30,r.tell()),c=r.getString(30,r.tell())):(u="Unknown",c="Unknown"),$("header .name_and_author").empty();var a=$("<p>").text(c+" - "+u);$("header .name_and_author").append(a),t(e,n)},o.onerror=function(e){e.target.error.code==e.target.error.NOT_READABLE_ERR&&alert("Failed to read file: "+n.name)},o.readAsArrayBuffer(n)},B=function(e,n){var t=n;return t.forEach(function(n){e.forEach(function(e){n.frequency.value===e.frequency&&(n.gain.value=e.gain)})}),t},b=function(e){var n;return n="pop"===e?B(m,i):"rock"===e?B(v,i):"jazz"===e?B(q,i):"classic"===e?B(h,i):i},x=function(){var e,n=t.width,o=t.height,a=r.frequencyBinCount,i=new Uint8Array(a);r.fftSize=2048,l.clearRect(0,0,n,o);var c=function(){e=requestAnimationFrame(c),r.getByteTimeDomainData(i),l.fillStyle="rgb(255, 255, 255)",l.fillRect(0,0,n,o),l.lineWidth=2,l.strokeStyle="rgb(47, 79, 79)",l.beginPath();for(var u=1*n/a,f=0,d=0;a>d;d++){var g=i[d]/128,y=g*o/2;0===d?l.moveTo(f,y):l.lineTo(f,y),f+=u}l.lineTo(t.width,t.height/2),l.stroke()};c()},z=function(t,a){e.decodeAudioData(a,function(a){n=a,o=e.createBufferSource(),r=e.createAnalyser(),i=_(),o.buffer=n,o.loop=!1;var c=b(t);o.connect(r),r.connect(c[0]),c[c.length-1].connect(e.destination),x(),f===!1?R():f=!1},function(e){console.log("Error decoding file "+e)})},D=function(){"undefined"==typeof a?alert("Choose audio file first"):""===s&&alert("Choose equalizer mode")},R=function(){"undefined"!=typeof o&&d===!1?(o.start(0),d=!0):D()},L=function(){"undefined"!=typeof o&&(o.stop(0),d=!1)};window.addEventListener("load",function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,e=new AudioContext,t=w(g,y),$("#visualField").append(t),l=t.getContext("2d")}catch(n){alert("Opps.. Your browser does not support audio API")}},!1);var F=document.getElementById("download");F.addEventListener("change",E,!1),$("#play").click(function(){d===!1&&C(s,a,z)}),$("#stop").click(function(){d===!0&&L()});var I=document.getElementById("drop_zone_id");I.addEventListener("dragover",T,!1),I.addEventListener("drop",k,!1);var P,U=function(e,n){"undefined"!=typeof a?(d===!0&&L(),C(e,a,z)):(alert("Choose audio file first"),n.checked="")},j=document.querySelector("#pop"),O=document.querySelector("#rock"),Y=document.querySelector("#jazz"),G=document.querySelector("#classic"),N=document.querySelector("#normal");j.onclick=function(){s="pop",P=j,U(s,P)},O.onclick=function(){s="rock",P=O,U(s,P)},Y.onclick=function(){s="jazz",P=O,U(s,P)},G.onclick=function(){s="classic",P=O,U(s,P)},N.onclick=function(){s="normal",P=O,U(s,P)}};$(document).ready(main);
