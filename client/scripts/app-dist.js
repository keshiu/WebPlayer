"use strict";var main=function(){function e(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}var n,t,o,a,r,i,c,u,d=null,l=512,f=120,s=function(e,n){var t=document.createElement("canvas");return t.width=e,t.height=n,t},m=function(){var e,n=this.files;i=n[0],e=$("<p>").text(i.name),$("main .drop_zone").empty(),$("main .drop_zone").append(e)},p=function(e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer.files;i=n[0];var t=$("<p>").text(i.name);$("main .drop_zone").empty(),$("main .drop_zone").append(t)},g=function(e,n){var t=new FileReader;t.onload=function(){var e=t.result,o=new jDataView(t.result);"TAG"==o.getString(3,o.byteLength-128)?(u=o.getString(30,o.tell()),c=o.getString(30,o.tell())):(u="Unknown",c="Unknown"),$("header .name_and_author").empty();var a=$("<p>").text(c+" - "+u);$("header .name_and_author").append(a),n(e)},t.onerror=function(n){n.target.error.code==n.target.error.NOT_READABLE_ERR&&alert("Failed to read file: "+e.name)},t.readAsArrayBuffer(e)},h=function(){function e(){n=requestAnimationFrame(e),r.getByteTimeDomainData(c),d.fillStyle="rgb(255, 255, 255)",d.fillRect(0,0,t,o),d.lineWidth=2,d.strokeStyle="rgb(47, 79, 79)",d.beginPath();for(var u=1*t/i,l=0,f=0;i>f;f++){var s=c[f]/128,m=s*o/2;0===f?d.moveTo(l,m):d.lineTo(l,m),l+=u}d.lineTo(a.width,a.height/2),d.stroke()}var n,t=a.width,o=a.height,i=r.frequencyBinCount,c=new Uint8Array(i);r.fftSize=2048,d.clearRect(0,0,t,o),e()},w=function(e){n.decodeAudioData(e,function(e){t=e,o=n.createBufferSource(),r=n.createAnalyser(),o.buffer=t,o.loop=!1,o.connect(r),r.connect(n.destination),h(),v()},function(e){console.log("Error decoding file "+e)})},v=function(){o.start(0)},y=function(){o.stop(0)};window.addEventListener("load",function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,n=new AudioContext,a=s(l,f),$("#visualField").append(a),d=a.getContext("2d")}catch(e){alert("Opps.. Your browser do not support audio API")}},!1);var A=document.getElementById("download");A.addEventListener("change",m,!1),$("#play").click(function(){g(i,w)}),$("#stop").click(function(){y()});var E=document.getElementById("drop_zone_id");E.addEventListener("dragover",e,!1),E.addEventListener("drop",p,!1)};$(document).ready(main);
